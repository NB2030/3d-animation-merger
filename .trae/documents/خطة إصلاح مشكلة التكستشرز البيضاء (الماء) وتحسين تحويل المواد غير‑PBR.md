## سبب محتمل سريع
- في `scripts/main.js:206-208` يتم إجبار لون المادة إلى الأبيض عندما لا توجد `map`، وهذا يُحوّل أي مادة بلا خريطة لون إلى سطح أبيض بالكامل (حالة الماء لديك).
- أثناء التحويل إلى Unlit، لم ننقل خصائص مهمة مثل `alphaMap` و`vertexColors`؛ إذا كان الماء يعتمد على قناة ألفا أو ألوان رؤوس، يفقد الشكل ويظهر أبيض.

## التغييرات المقترحة
### 1) إزالة إجبار اللون الأبيض
- احذف السطر الذي يضبط `m.color.set(0xffffff)` عندما لا توجد `map` في `scripts/main.js:206-208` للحفاظ على اللون الأصلي.

### 2) نقل خصائص المادة المهمة عند التحويل إلى Unlit
- تعديل `fixNonPBRMaterials()` في `scripts/main.js:260-285` ليشمل:
  - `alphaMap: mat.alphaMap || null`
  - `vertexColors: !!mat.vertexColors`
  - الحفاظ على `transparent` كـ `mat.transparent || mat.opacity < 1`
  - ضبط `map.flipY = false` و`wrapS/T = RepeatWrapping` عند الحاجة، مع بقاء `colorSpace = SRGB` للتكستشرز اللونية.

### 3) التعامل مع مصفوفة مواد
- إذا كانت المادة مصفوفة، طبّق نفس النقل لكل عنصر مادة.

### 4) واجهة اختيار وضع المادة
- إضافة تبديل لكل مادة: `Mode: Unlit | PBR` حتى نستثني مواد مثل الماء من التحويل التلقائي إذا لزم.

### 5) التحقق البصري
- جرّب موديل الماء بعد الإصلاح:
  - تأكد من ظهور القناة الشفافة.
  - تأكد من ألوان الرؤوس إن وُجدت.
  - صدّر GLB وتحقق في عارض خارجي أن المادة تُصدَّر مع `KHR_materials_unlit` (إن كانت Unlit).

## أثر التغيير
- يمنع ظهور الأسطح البيضاء غير المقصودة ويعيد شكل الماء كما في المصدر.
- يحافظ على الشفافية وألوان الرؤوس عند التحويل إلى Unlit.

## مخاطر وتخفيف
- بعض المواد قد تعتمد على خصائص غير منقولة (مثل `specular` في Phong)؛ لدينا تبديل PBR لتلك الحالات.
- إذا بقيت المادة بيضاء، سنضيف قاعدة لكشف خرائط رمادية أحادية القناة وتحويلها تلقائياً إلى `alphaMap` بدل `map`.

## الخطوة التالية
- تنفيذ التغييرات في النقاط 1–3، ثم إضافة التبديل في الواجهة (نقطة 4) واختبار الحالة على نموذجك.